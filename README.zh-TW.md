# GameMatchDemo

## 專案簡介

**GameMatchDemo是一個基於 C++ 開發並支援多執行緒的簡易遊戲匹配Demo專案，運行於 Windows 11 平台，使用 SQLite3 作為資料庫。**  
**它模擬了批次玩家加入匹配隊列、自動組隊、進入戰鬥、戰鬥結果處理及數據保存的流程。**
**用以展示實現一個匹配系統的核心邏輯、排程處裡、玩家數據管理、持久化儲存以及多執行緒併發處理等。**
## 專案目標

作為個人編程能力和伺服器開發理解的Demo  
** 展示 C++ 多執行緒編程和同步機制，處理並發操作。  
** 核心邏輯包含玩家創建、狀態管理、分級匹配系統和資料庫讀寫。  
** 實現資料持久化，使用SQLite進行玩家資料的讀取和異步回寫。  
** 實現排程任務管理器，用於定時執行後台任務 (資料庫回寫) 。  

## 核心功能

### 玩家管理器 (PlayerManager)
** 玩家登入/登出機制。  
** 管理玩家的在線狀態和遊戲內狀態 (離線/匹配中/戰鬥中/大廳)。  
** 處理玩家戰鬥結果並更新分數和勝場。  
** 異步回寫 : 當玩家資料有變動時會加入排程，並定時回寫資料庫。  

### 戰鬥匹配管理器 (BattleManager)
** 根據玩家階位 (Tier) 進行分級匹配。自動組隊機制 (3v3) 。  
** 創建獨立的戰鬥房間 (BattleRoom) 以及戰鬥單位英雄 (Hero) 。  
** 各房間獨立執行緒進行簡單模擬戰鬥與結果。  
** 戰鬥結束後的勝負判定和結果會同步。  

### 資料庫管理器 (DbManager)
** 基於 SQLite 輕量化資料庫實現數據的持久化存儲。  
** 提供玩家戰鬥數據的增、刪、查、改介面。  
** 初始化時確保資料庫表結構必須存在並會將資料載入遊戲中。  

### 任務排程管理器(ScheduleManager)
** 通用的多執行緒安全的任務排程器。  
** 支持週期性任務 (ex. 玩家資料回寫) 和一次性任務。  

## 專案結構
```
 .
 ├── include/
 │   └── globalDefine.h          # 全域定義
 ├── libs/
 │   └── sqlite/                 # Sqlte資料庫
 │       ├── sqlite3.c
 │       └── sqlite3.h
 ├── src/
 │   ├── managers/
 │   │   ├── battleManager.cpp   # 戰鬥和匹配核心邏輯
 │   │   ├── battleManager.h
 │   │   ├── dbManager.cpp       # SQLite 數據庫操作介面
 │   │   ├── dbManager.h
 │   │   ├── playerManager.cpp   # 玩家數據管理
 │   │   ├── playerManager.h
 │   │   ├── scheduleManager.cpp # 定時任務排程器
 │   │   └── scheduleManager.h
 │   ├── objects/
 │   │   ├── hero.cpp            # 英雄類別
 │   │   ├── hero.h
 │   │   ├── player.cpp          # 玩家類別
 │   │   └── player.h
 │   └── main.cpp                # 應用程式入口，初始化管理器，處理用戶命令
 ├── utils/
 │  ├── utils.cpp                # 工具函式 (時間, 字串處理)
 │  └── utils.h
 ├── README.md
 └── README.zh-TW.md
```
## 未來規劃清單

此專案作為一個概念驗證的多執行緒伺服器應用範例，旨在展示核心的玩家管理、戰鬥匹配與數據持久化功能。
鑑於專案開發時間的考量，許多進階功能和最佳實踐尚未完全整合。
以下是規劃中的項目：

<details>
  <summary>優化關機流程</summary>

  * **規劃:** 關機流程可進一步完善為確保系統在關閉時，所有服務都能安全且有序地停止，並完成所有資料的完整回存，以保證資料的可靠性與系統的穩定性。
  * **實踐:** 實作一個全域的伺服器狀態管理中心，當接收到關機指令時，先協調各管理器 (Manager) 依序執行其 `shutdown()` 邏輯，確保所有運作中的服務平穩終止，並在資料持久化完成後再行關閉程序。
</details>

<details>
  <summary>強化匹配機制安全性</summary>

  * **規劃:** 匹配機制在是在玩家中途狀態變更（例如主動退出或超時）時，應該確保隊列的完整性與玩家狀態的同步。
  * **實踐:** 實作玩家退出安全機制，使匹配過程在玩家加入或從移除時，都必須能夠同步玩家狀態，並維護資料一致性，避免潛在的空指針問題。
</details>

<details>
  <summary>提升匹配機制效率</summary>

  * **規劃:** 現階段基於線性的匹配邏輯，在處理大量玩家時仍有提升空間，目標是加快匹配速度與資源利用效率。
  * **實踐:** 考慮引入事件驅動架構，以及更高效的積分排序和匹配算法，另外完善組隊功能，可將匹配效率提升至 O(log N) 的等級並節省記憶體的佔用。
</details>

<details>
  <summary>數據庫升級</summary>

  * **規劃:** 基於在高併發與大數據量情境下的需求，必須提升資料庫，以提供更好的吞吐量、可擴展性和資料安全性。
  * **實踐:** 將資料遷移至 MySQL 或 PostgreSQL 等功能更全面且性能更優異的資料庫伺服器，並透過實作連接池與各種讀寫優化策略，以應對高併發存取挑戰。
</details>

<details>
  <summary>導入物件池機制</summary>

  * **規劃:** 為提升程式效能與系統長期穩定性，將優化頻繁建立和銷毀物件（如 BattleRoom 和 Hero）的記憶體管理策略。
  * **實踐:** 透過物件池可預先配置物件數量，當需要物件時從池中借用，使用完畢後再將其回收至池中，從而避免頻繁的動態記憶體分配與釋放操作，降低 CPU 負擔並減少記憶體碎片化風險。
</details>
## 作者

* August Jian(sppaugust@gmail.com)

